<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Живая книга</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/css/page-flip.min.css">
<style>
  html,body{
    margin:0;
    height:100%;
    background:transparent;
    overflow:hidden;
  }

  /* Контейнер с запасом пространства */
  #bookWrapper {
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    background:transparent;
  }

  #book {
    background:transparent;
  }

  /* Тени вокруг страниц */
  .stf__item {
    box-shadow: 0 0 25px rgba(0,0,0,0.25);
    position:relative;
  }
  /* Виньетка */
  .stf__item::before {
    content:"";
    position:absolute;
    top:0; bottom:0; left:0; right:0;
    pointer-events:none;
    background: radial-gradient(ellipse at center,
      rgba(0,0,0,0.20) 0%, rgba(0,0,0,0) 70%);
  }
</style>
</head>
<body>
<div id="bookWrapper">
  <div id="book"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
<script>
function getParams(){
  const p=new URLSearchParams(location.search);
  return {
    imgs:(p.get('imgs')||"").split('|').map(decodeURIComponent).filter(Boolean),
    w: parseInt(p.get('w')||600),
    h: parseInt(p.get('h')||900),
    flipTime: parseInt(p.get('flipTime')||800),
    showHint: p.get('showHint')==="true"
  };
}

const {imgs,w,h,flipTime,showHint}=getParams();

if(!imgs.length){
  document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><div style="padding:12px 20px;background:#000;color:#fff;border-radius:8px;">Пустой imgs — нет изображений.</div></div>';
}else{
  const bookEl=document.getElementById("book");

  const pageFlip=new St.PageFlip(bookEl,{
    width:w,
    height:h,
    size:"fixed",
    flippingTime:flipTime,
    showCover:true,
    drawShadow:true,
    showHint:showHint,
    maxShadowOpacity:0.4,
    mobileScrollSupport:false
  });

  pageFlip.loadFromImages(imgs);

  // Обложка без лишней тени сбоку
  pageFlip.on("flip", (e)=>{
    const current=e.data;
    const total=imgs.length;
    const pages=document.querySelectorAll(".stf__item");
    pages.forEach(p=>p.style.boxShadow="0 0 25px rgba(0,0,0,0.25)");
    if(current===0 || current===total-1){
      pages[0].style.boxShadow="0 8px 20px rgba(0,0,0,0.3)";
    }
  });
}
</script>
</body>
</html>
