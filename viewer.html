<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Teachy Witchy — Живая книга</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/css/page-flip.min.css">
<style>
  html,body{margin:0;height:100%;background:transparent;overflow:hidden;touch-action:manipulation}
  .scene{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:transparent;overflow:visible}
  :root{--padX:0px;--padY:0px}
  .book-wrapper{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:var(--padY) var(--padX);overflow:visible;background:transparent}
  .book-frame{position:relative;background:transparent;overflow:visible;transform-origin:center;will-change:transform;z-index:1}

  #book{width:100%;height:100%;background:transparent}
  .stf__wrapper,.stf__block{overflow:visible!important}

  .page{position:relative;width:100%;height:100%;background:transparent}
  .page img{width:100%;height:100%;object-fit:contain;display:block;user-select:none;-webkit-user-drag:none;pointer-events:none}

  /* внутренняя бумага */
  .stf__page{
    background:transparent!important;overflow:visible!important;
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.08),0 4px 6px rgba(0,0,0,.15)
  }
  .stf__item--hard .stf__page{box-shadow:inset 0 0 0 1px rgba(0,0,0,.08)}
  .stf__page::after{
    content:"";position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;z-index:2;
    background:radial-gradient(125% 110% at 50% 50%, rgba(0,0,0,.16) 0%, rgba(0,0,0,0) 62%);
  }

  /* внешние виньетки */
  .stf__item--left::after,.stf__item--right::after{
    content:"";position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;z-index:1
  }
  .stf__item--left::after {background:linear-gradient(90deg, rgba(0,0,0,.22) 0%, rgba(0,0,0,0) 16%)}
  .stf__item--right::after{background:linear-gradient(90deg, rgba(0,0,0,0) 84%, rgba(0,0,0,.22) 100%)}
  .stf__item--left::before,.stf__item--right::before{
    content:"";position:absolute;top:0;bottom:0;width:3.2%;pointer-events:none;mix-blend-mode:multiply;opacity:.45;z-index:1
  }
  .stf__item--left::before {right:0;background:linear-gradient(90deg, rgba(0,0,0,.70), rgba(0,0,0,0))}
  .stf__item--right::before{left:0; background:linear-gradient(90deg, rgba(0,0,0,0), rgba(0,0,0,.70))}

  /* --- главное: падающая тень по альфе страницы */
  .stf__item{
    filter:
      drop-shadow(0 14px 18px rgba(0,0,0,.28))
      drop-shadow(0 2px 8px rgba(0,0,0,.22));
  }
  .book-frame.single .stf__item::before{display:none}
  .book-frame.single .stf__item--left::after,
  .book-frame.single .stf__item--right::after{background:none}

  /* уголки */
  .stf__page>.corner{
    position:absolute;inset:0;pointer-events:none;z-index:3;
    background:
      radial-gradient(26% 26% at 100% 0%, rgba(0,0,0,.20) 0%, rgba(0,0,0,0) 60%) top right / 48% 48% no-repeat,
      radial-gradient(26% 26% at 0% 100%, rgba(0,0,0,.20) 0%, rgba(0,0,0,0) 60%) bottom left / 48% 48% no-repeat;
    opacity:.35;
  }

  /* хиты для Genially */
  .hit{position:absolute;top:0;bottom:0;width:50%;z-index:9;background:transparent;pointer-events:auto;touch-action:none}
  .hit.left{left:0}
  .hit.right{right:0}
</style>
</head>
<body>
<div class="scene">
  <div class="book-wrapper">
    <div id="frame" class="book-frame">
      <div class="hit left" aria-hidden="true"></div>
      <div id="book"></div>
      <div class="hit right" aria-hidden="true"></div>
    </div>
  </div>
</div>

<audio id="flipSound" preload="auto" src="flip.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
<script>
const urls=[
  "cover.png",
  "page1.png","page2.png","page3.png","page4.png",
  "back.png"
];

const flipTime=1200;
const scene=document.querySelector('.scene');
const wrapper=document.querySelector('.book-wrapper');
const frame=document.getElementById('frame');
const book=document.getElementById('book');

const pageW=800, pageH=1000;
const padX=Math.round(pageW*0.16);
const padY=Math.round(pageH*0.22);
wrapper.style.setProperty('--padX',padX+'px');
wrapper.style.setProperty('--padY',padY+'px');

frame.style.width=(pageW*2)+'px';
frame.style.height=pageH+'px';

function fit(){
  const availW=scene.clientWidth, availH=scene.clientHeight;
  const needW=pageW*2+padX*2, needH=pageH+padY*2;
  const s=Math.min(availW/needW, availH/needH);
  frame.style.transform='scale('+s+')';
}
addEventListener('resize',fit,{passive:true}); fit();

const pf=new St.PageFlip(book,{
  width:pageW,height:pageH,size:'fixed',autoSize:false,
  usePortrait:false,showCover:true,
  flippingTime:flipTime,drawShadow:true,maxShadowOpacity:.85,
  mobileScrollSupport:false,showHint:false
});

const pages=[];
urls.forEach((src,i)=>{
  const p=document.createElement('div'); p.className='page';
  p.setAttribute('data-density',(i===0||i===urls.length-1)?'hard':'soft');
  const img=document.createElement('img'); img.src=src; p.appendChild(img);
  const c=document.createElement('div'); c.className='corner'; p.appendChild(c);
  book.appendChild(p);
  pages.push(p);
});
(typeof pf.loadFromHTML==='function')?pf.loadFromHTML(pages):pf.loadFromImages(urls);

const flipSound=document.getElementById('flipSound');
pf.on('flip',()=>{ try{flipSound.currentTime=0; flipSound.play();}catch(e){} syncSingle(); });

function syncSingle(){
  const i=pf.getCurrentPageIndex();
  frame.classList.toggle('single',(i===0||i===urls.length-1));
}
syncSingle();

/* невидимые кликовые зоны */
const leftHit  = frame.querySelector('.hit.left');
const rightHit = frame.querySelector('.hit.right');
let lock=false;
function safeFlip(dir){
  if(lock||pf.isFlipping()) return;
  lock=true;
  (dir==='prev')?pf.flipPrev('top'):pf.flipNext('top');
  setTimeout(()=>lock=false, pf.getSettings().flippingTime+60);
}
function bindHit(el,dir){
  const handler=(e)=>{e.preventDefault(); safeFlip(dir);}
  el.addEventListener('pointerdown',handler,{passive:false});
  el.addEventListener('click',handler,{passive:false});
}
bindHit(leftHit,'prev');
bindHit(rightHit,'next');
</script>
</body>
</html>
