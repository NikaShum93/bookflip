<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PageFlip Editor for Genially</title>
<link rel="stylesheet" href="https://unpkg.com/page-flip/dist/css/page-flip.min.css">
<style>
  :root{--bg:#0f1115;--fg:#e7eef7;--mut:#9fb3c8;--acc:#7bd7ff;--bd:#2a2f3a;}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:14px/1.4 system-ui,Segoe UI,Roboto,Arial;}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns: 1.1fr .9fr; gap:18px;}
  h1{margin:0 0 10px;font-size:20px}
  .card{background:#121520;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;align-items:center;margin:8px 0}
  textarea, input, select{width:100%;background:#0b0e14;color:var(--fg);border:1px solid var(--bd);border-radius:10px;padding:10px}
  textarea{min-height:160px;white-space:pre}
  .btn{background:var(--acc);color:#002b3a;border:0;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:700}
  .btn.sec{background:#1d2330;color:var(--fg);border:1px solid var(--bd)}
  .mut{color:var(--mut)}
  .cols{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .out{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size:12px}
  iframe{width:100%;height:420px;border:1px solid var(--bd);border-radius:12px;background:#000}
  .hint{font-size:12px;color:var(--mut)}
  .pill{padding:4px 8px;background:#1d2330;border:1px solid var(--bd);border-radius:999px;font-size:12px}
  @media (max-width: 980px){ .wrap{grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Книга для Genially — редактор</h1>
    <div class="row"><span class="pill">1</span><div class="mut">Вставь <b>по одной ссылке на изображение</b> в строку (обложка первой)</div></div>
    <textarea id="imgs" placeholder="https://.../cover.jpg
https://.../page1.jpg
https://.../page2.jpg"></textarea>

    <div class="row cols">
      <div>
        <label>Время перелистывания, мс</label>
        <input id="flipTime" type="number" value="800" min="200" step="50"/>
      </div>
      <div>
        <label>Наклон (почти прямо = 0..4)</label>
        <input id="tilt" type="number" value="2" min="0" max="12"/>
      </div>
    </div>

    <div class="row">
      <div style="flex:1">
        <label>Звук перелистывания (URL на .mp3/.wav)</label>
        <input id="sfx" placeholder="https://.../page-flip.mp3"/>
        <div class="hint">Подойдёт любой CC0 / royalty-free (например, Pixabay / Freesound).</div>
      </div>
      <button class="btn sec" id="testSound">Тест</button>
    </div>

    <div class="row cols">
      <div>
        <label>Размер книги в Genially (ширина×высота, px)</label>
        <div class="row">
          <input id="w" type="number" value="900" min="300" step="10" style="max-width:120px"> ×
          <input id="h" type="number" value="600" min="220" step="10" style="max-width:120px">
        </div>
        <div class="hint">Поставь такие же размеры у iframe в Genially.</div>
      </div>
      <div>
        <label>Подсказки перелистывания</label>
        <select id="showHint">
          <option value="false">Выключить</option>
          <option value="true">Включить</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px; gap:10px">
      <button class="btn" id="gen">Сгенерировать ссылку + iframe</button>
      <button class="btn sec" id="preview">Превью ниже</button>
    </div>
  </div>

  <div class="card">
    <div class="row"><span class="pill">2</span><div class="mut">Скопируй iframe и вставь в Genially → «Внешний контент / URL»</div></div>
    <div class="row"><label>Ссылка на книгу:</label></div>
    <input id="outUrl" class="out" readonly/>
    <div class="row" style="gap:8px">
      <button class="btn sec" id="copyUrl">Копировать ссылку</button>
    </div>
    <div class="row"><label>iframe для Genially:</label></div>
    <textarea id="outIframe" class="out" rows="6" readonly></textarea>
    <div class="row" style="gap:8px">
      <button class="btn sec" id="copyIframe">Копировать iframe</button>
    </div>
    <div class="row"><span class="pill">3</span><div class="mut">Превью</div></div>
    <iframe id="live" allow="autoplay"></iframe>

    <div style="margin-top:12px">
      <div class="mut" style="margin-bottom:6px"><b>Где быстро залить картинки и получить прямые ссылки?</b></div>
      <ul class="hint">
        <li><b>GitHub</b>: положи файлы в <code>/images</code>, используй <i>Raw</i>-ссылки вида <code>https://raw.githubusercontent.com/&lt;user&gt;/&lt;repo&gt;/main/images/&lt;file&gt;.jpg</code>.</li>
        <li><b>Dropbox</b>: Share link → замени <code>?dl=0</code> на <code>?raw=1</code> для прямого URL.</li>
        <li><b>Imgur</b>: копируй прямые ссылки <code>https://i.imgur.com/....jpg</code>.</li>
      </ul>
    </div>
  </div>
</div>

<script>
function enc(o){ return encodeURIComponent(o); }
function buildUrl(){
  // viewer.html должен лежать рядом с editor.html
  const base = location.origin + location.pathname.replace(/editor\.html$/,'') + 'viewer.html';
  const lines = (document.getElementById('imgs').value||'')
    .split(/\r?\n/)
    .map(s=>s.trim())
    .filter
